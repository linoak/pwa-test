<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾…è¾¦äº‹é …æ¸…å–® - å®Œæ•´PWAç‰ˆ</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA åœ–ç¤º -->
    <link rel="icon" type="image/png" sizes="32x32" href="./icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="./icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="./icons/icon-180x180.png">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“ å¾…è¾¦äº‹é …æ¸…å–®</h1>
            <button id="installPWA" class="install-pwa-btn" style="display: none;">ğŸ“± å®‰è£APP</button>
        </header>

        <!-- PWA å®‰è£æç¤ºå€åŸŸ -->
        <div id="pwaInstallBanner" class="pwa-install-banner" style="display: none;">
            <div class="banner-content">
                <span>ğŸ“± å°‡æ­¤APPå®‰è£åˆ°æ‰‹æ©Ÿä¸»ç•«é¢ï¼Œäº«å—æ›´å¥½çš„ä½¿ç”¨é«”é©—ï¼</span>
                <button id="bannerInstallBtn" class="banner-install-btn">å®‰è£</button>
                <button id="bannerDismissBtn" class="banner-dismiss-btn">ç¨å¾Œ</button>
            </div>
        </div>

        <!-- æ–°å¢å¾…è¾¦äº‹é …è¡¨å–® -->
        <div class="add-form">
            <div class="input-group">
                <input type="text" id="todoInput" placeholder="è¼¸å…¥å¾…è¾¦äº‹é …... (æœ€å¤š100å‰‡)" maxlength="100">
                <input type="date" id="todoDate" value="">
                <div class="color-picker">
                    <label for="todoColor">é¸æ“‡é¡è‰²:</label>
                    <select id="todoColor">
                        <option value="#000000">é»‘è‰²</option>
                        <option value="#FF0000">ç´…è‰²</option>
                        <option value="#00FF00">ç¶ è‰²</option>
                        <option value="#0000FF">è—è‰²</option>
                        <option value="#FFA500">æ©™è‰²</option>
                        <option value="#800080">ç´«è‰²</option>
                        <option value="#FFC0CB">ç²‰è‰²</option>
                        <option value="#A52A2A">æ£•è‰²</option>
                    </select>
                </div>
            </div>
            <button id="addBtn" class="add-btn">æ–°å¢</button>
            <div class="todo-limit-info">
                <span id="todoLimitInfo">é‚„å¯æ–°å¢ 100 å‰‡è¨˜äº‹</span>
            </div>
        </div>

        <!-- åˆ†é¡æ¨™ç±¤ -->
        <div class="tabs">
            <button class="tab-btn active" data-filter="today">ä»Šå¤©</button>
            <button class="tab-btn" data-filter="week">æœ¬é€±</button>
            <button class="tab-btn" data-filter="all">å…¨éƒ¨</button>
            <button class="tab-btn" data-filter="overdue">éæœŸ</button>
        </div>

        <!-- å¾…è¾¦äº‹é …åˆ—è¡¨ -->
        <div class="todo-list" id="todoList">
            <!-- å¾…è¾¦äº‹é …å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <!-- çµ±è¨ˆè³‡è¨Š -->
        <div class="stats">
            <div class="stat-item">
                <span class="stat-number" id="totalCount">0/100</span>
                <span class="stat-label">ç¸½è¨ˆ</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="completedCount">0</span>
                <span class="stat-label">å·²å®Œæˆ</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="pendingCount">0</span>
                <span class="stat-label">å¾…å®Œæˆ</span>
            </div>
        </div>
        
        <!-- è¨˜äº‹æ•¸é‡é€²åº¦æ¢ -->
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0% (0/100)</div>
        </div>
    </div>

    <!-- ç·¨è¼¯å¾…è¾¦äº‹é …çš„æ¨¡æ…‹æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>ç·¨è¼¯å¾…è¾¦äº‹é …</h2>
            <div class="edit-form">
                <input type="text" id="editInput" placeholder="ç·¨è¼¯å¾…è¾¦äº‹é …... (æœ€å¤š100å­—)" maxlength="100">
                <input type="date" id="editDate">
                <div class="color-picker">
                    <label for="editColor">é¸æ“‡é¡è‰²:</label>
                    <select id="editColor">
                        <option value="#000000">é»‘è‰²</option>
                        <option value="#FF0000">ç´…è‰²</option>
                        <option value="#00FF00">ç¶ è‰²</option>
                        <option value="#0000FF">è—è‰²</option>
                        <option value="#FFA500">æ©™è‰²</option>
                        <option value="#800080">ç´«è‰²</option>
                        <option value="#FFC0CB">ç²‰è‰²</option>
                        <option value="#A52A2A">æ£•è‰²</option>
                    </select>
                </div>
                <div class="edit-buttons">
                    <button id="saveEditBtn" class="save-btn">å„²å­˜</button>
                    <button id="cancelEditBtn" class="cancel-btn">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å®Œæ•´çš„TodoAppé¡åˆ¥
        class TodoApp {
            constructor() {
                try {
                    const storedTodos = localStorage.getItem('todos');
                    if (storedTodos) {
                        this.todos = JSON.parse(storedTodos);
                    } else {
                        this.todos = [];
                    }
                } catch (error) {
                    console.error('è®€å–localStorageæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                    this.todos = [];
                }
                
                this.currentFilter = 'today';
                this.editingId = null;
                this.deferredPrompt = null;
                this.isOnline = navigator.onLine;
                
                this.init();
                this.setupPWA();
            }

            init() {
                this.setupEventListeners();
                this.setDefaultDate();
                this.renderTodos();
                this.updateStats();
                this.updateConnectionStatus();
            }

            setupPWA() {
                // ç›£è½å®‰è£æç¤º
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    this.deferredPrompt = e;
                    this.showInstallButton();
                    this.showInstallPrompt();
                });

                // ç›£è½å®‰è£å®Œæˆ
                window.addEventListener('appinstalled', () => {
                    this.hideInstallPrompt();
                    this.hideInstallButton();
                    this.showNotification('APPå·²æˆåŠŸå®‰è£åˆ°ä¸»ç•«é¢ï¼', 'success');
                });

                // ç›£è½ç¶²è·¯ç‹€æ…‹
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.updateConnectionStatus();
                    this.hideOfflineNotice();
                });

                window.addEventListener('offline', () => {
                    this.isOnline = false;
                    this.updateConnectionStatus();
                    this.showOfflineNotice();
                });

                // è¨»å†ŠService Worker
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('./sw.js')
                        .then(registration => {
                            console.log('ServiceWorker registered successfully');
                        })
                        .catch(error => {
                            console.log('ServiceWorker registration failed:', error);
                        });
                }

                // æª¢æŸ¥æ˜¯å¦å·²ç¶“å®‰è£
                this.checkIfInstalled();
                
                // å¼·åˆ¶é¡¯ç¤ºå®‰è£æŒ‰éˆ•ï¼ˆç”¨æ–¼GitHub Pagesï¼‰
                setTimeout(() => {
                    this.showInstallButton();
                }, 3000);
            }

            showInstallButton() {
                const installBtn = document.getElementById('installPWA');
                if (installBtn) {
                    installBtn.style.display = 'block';
                    installBtn.style.animation = 'pulse 2s infinite';
                }
                
                // åŒæ™‚é¡¯ç¤ºæ©«å¹…
                this.showInstallBanner();
            }

            hideInstallButton() {
                const installBtn = document.getElementById('installPWA');
                if (installBtn) {
                    installBtn.style.display = 'none';
                }
                
                // åŒæ™‚éš±è—æ©«å¹…
                this.hideInstallBanner();
            }

            checkIfInstalled() {
                // æª¢æŸ¥æ˜¯å¦åœ¨ç¨ç«‹æ¨¡å¼ä¸‹é‹è¡Œï¼ˆå·²å®‰è£ï¼‰
                if (window.matchMedia('(display-mode: standalone)').matches || 
                    window.navigator.standalone === true) {
                    this.hideInstallButton();
                } else {
                    // å¦‚æœæ²’æœ‰å®‰è£ï¼Œé¡¯ç¤ºå®‰è£æŒ‰éˆ•
                    setTimeout(() => {
                        this.showInstallButton();
                    }, 2000);
                }
            }

            setupEventListeners() {
                // æ–°å¢å¾…è¾¦äº‹é …
                document.getElementById('addBtn').addEventListener('click', () => this.addTodo());
                
                // æŒ‰Enteréµæ–°å¢
                document.getElementById('todoInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.addTodo();
                });

                // åˆ†é¡æ¨™ç±¤åˆ‡æ›
                const tabButtons = document.querySelectorAll('.tab-btn');
                tabButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        this.switchTab(e.target.dataset.filter);
                    });
                });

                // æ¨¡æ…‹æ¡†é—œé–‰
                document.querySelector('.close').addEventListener('click', () => this.closeModal());
                document.getElementById('cancelEditBtn').addEventListener('click', () => this.closeModal());
                
                // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
                window.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        this.closeModal();
                    }
                });

                // å„²å­˜ç·¨è¼¯
                document.getElementById('saveEditBtn').addEventListener('click', () => this.saveEdit());

                // PWA å®‰è£æŒ‰éˆ•
                const installBtn = document.getElementById('installPWA');
                if (installBtn) {
                    installBtn.addEventListener('click', () => this.installApp());
                }

                // PWA æ©«å¹…å®‰è£æŒ‰éˆ•
                const bannerInstallBtn = document.getElementById('bannerInstallBtn');
                if (bannerInstallBtn) {
                    bannerInstallBtn.addEventListener('click', () => this.installApp());
                }

                // PWA æ©«å¹…é—œé–‰æŒ‰éˆ•
                const bannerDismissBtn = document.getElementById('bannerDismissBtn');
                if (bannerDismissBtn) {
                    bannerDismissBtn.addEventListener('click', () => this.hideInstallBanner());
                }
            }

            setDefaultDate() {
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('todoDate').value = today;
            }

            addTodo() {
                const input = document.getElementById('todoInput');
                const dateInput = document.getElementById('todoDate');
                const colorSelect = document.getElementById('todoColor');
                
                const text = input.value.trim();
                const date = dateInput.value;
                const color = colorSelect.value;
                
                if (!text || !date) {
                    alert('è«‹è¼¸å…¥å¾…è¾¦äº‹é …å’Œé¸æ“‡æ—¥æœŸï¼');
                    return;
                }

                // æª¢æŸ¥æ˜¯å¦å·²é”åˆ°100å‰‡è¨˜äº‹é™åˆ¶
                if (this.todos.length >= 100) {
                    alert('å·²é”åˆ°100å‰‡è¨˜äº‹é™åˆ¶ï¼è«‹å…ˆåˆªé™¤ä¸€äº›èˆŠçš„è¨˜äº‹ã€‚');
                    return;
                }

                const todo = {
                    id: Date.now(),
                    text: text,
                    date: date,
                    color: color,
                    completed: false,
                    createdAt: new Date().toISOString()
                };

                this.todos.push(todo);
                this.saveTodos();
                this.renderTodos();
                this.updateStats();
                
                // æ¸…ç©ºè¼¸å…¥æ¡†
                input.value = '';
                input.focus();
                
                // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
                this.showNotification(`å¾…è¾¦äº‹é …å·²æ–°å¢ï¼(ç¬¬${this.todos.length}/100å‰‡)`, 'success');
            }

            deleteTodo(id) {
                if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å¾…è¾¦äº‹é …å—ï¼Ÿ')) {
                    this.todos = this.todos.filter(todo => todo.id !== id);
                    this.saveTodos();
                    this.renderTodos();
                    this.updateStats();
                    this.showNotification('å¾…è¾¦äº‹é …å·²åˆªé™¤ï¼', 'info');
                }
            }

            toggleComplete(id) {
                const todo = this.todos.find(t => t.id === id);
                if (todo) {
                    todo.completed = !todo.completed;
                    this.saveTodos();
                    this.renderTodos();
                    this.updateStats();
                    
                    const message = todo.completed ? 'å·²å®Œæˆï¼' : 'å·²å–æ¶ˆå®Œæˆï¼';
                    this.showNotification(message, 'success');
                }
            }

            editTodo(id) {
                const todo = this.todos.find(t => t.id === id);
                if (todo) {
                    this.editingId = id;
                    document.getElementById('editInput').value = todo.text;
                    document.getElementById('editDate').value = todo.date;
                    document.getElementById('editColor').value = todo.color;
                    document.getElementById('editModal').style.display = 'block';
                }
            }

            saveEdit() {
                const input = document.getElementById('editInput');
                const dateInput = document.getElementById('editDate');
                const colorSelect = document.getElementById('editColor');
                
                const text = input.value.trim();
                const date = dateInput.value;
                const color = colorSelect.value;
                
                if (!text || !date) {
                    alert('è«‹è¼¸å…¥å¾…è¾¦äº‹é …å’Œé¸æ“‡æ—¥æœŸï¼');
                    return;
                }

                const todo = this.todos.find(t => t.id === this.editingId);
                if (todo) {
                    todo.text = text;
                    todo.date = date;
                    todo.color = color;
                    
                    this.saveTodos();
                    this.renderTodos();
                    this.updateStats();
                    this.closeModal();
                    this.showNotification('å¾…è¾¦äº‹é …å·²æ›´æ–°ï¼', 'success');
                }
            }

            closeModal() {
                document.getElementById('editModal').style.display = 'none';
                this.editingId = null;
            }

            switchTab(filter) {
                this.currentFilter = filter;
                
                // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                const targetBtn = document.querySelector(`[data-filter="${filter}"]`);
                if (targetBtn) {
                    targetBtn.classList.add('active');
                }
                
                this.renderTodos();
            }

            getFilteredTodos() {
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                
                // è¨ˆç®—æœ¬é€±çš„é–‹å§‹å’ŒçµæŸæ—¥æœŸ
                const weekStart = new Date(today);
                weekStart.setDate(today.getDate() - today.getDay());
                weekStart.setHours(0, 0, 0, 0);
                
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekStart.getDate() + 6);
                weekEnd.setHours(23, 59, 59, 999);
                
                switch (this.currentFilter) {
                    case 'today':
                        return this.todos.filter(todo => todo.date === todayStr);
                    case 'week':
                        return this.todos.filter(todo => {
                            const todoDate = new Date(todo.date);
                            todoDate.setHours(12, 0, 0, 0);
                            return todoDate >= weekStart && todoDate <= weekEnd;
                        });
                    case 'all':
                        return this.todos;
                    case 'overdue':
                        return this.todos.filter(todo => {
                            const todoDate = new Date(todo.date);
                            return todoDate < today && !todo.completed;
                        });
                    default:
                        return this.todos;
                }
            }

            renderTodos() {
                const todoList = document.getElementById('todoList');
                const filteredTodos = this.getFilteredTodos();
                
                if (filteredTodos.length === 0) {
                    todoList.innerHTML = `
                        <div class="empty-state">
                            <p>${this.getEmptyStateMessage()}</p>
                        </div>
                    `;
                    return;
                }

                // æŒ‰æ—¥æœŸæ’åº
                filteredTodos.sort((a, b) => new Date(a.date) - new Date(b.date));
                
                const htmlContent = filteredTodos.map(todo => this.renderTodoItem(todo)).join('');
                todoList.innerHTML = htmlContent;
            }

            getEmptyStateMessage() {
                switch (this.currentFilter) {
                    case 'today':
                        return 'ä»Šå¤©æ²’æœ‰å¾…è¾¦äº‹é …';
                    case 'week':
                        return 'æœ¬é€±æ²’æœ‰å¾…è¾¦äº‹é …';
                    case 'all':
                        return 'æ²’æœ‰å¾…è¾¦äº‹é …';
                    case 'overdue':
                        return 'æ²’æœ‰éæœŸçš„å¾…è¾¦äº‹é …';
                    default:
                        return 'æ²’æœ‰å¾…è¾¦äº‹é …';
                }
            }

            renderTodoItem(todo) {
                const date = new Date(todo.date);
                const formattedDate = `${date.getMonth() + 1}/${date.getDate()}`;
                
                return `
                    <div class="todo-item ${todo.completed ? 'completed' : ''}" data-id="${todo.id}">
                        <div class="todo-content">
                            <div class="todo-text" style="color: ${todo.color};">${todo.text}</div>
                            <div class="todo-date">${formattedDate}</div>
                        </div>
                        <div class="todo-actions">
                            <button class="complete-btn" onclick="app.toggleComplete(${todo.id})">
                                ${todo.completed ? 'âœ“' : 'â—‹'}
                            </button>
                            <button class="edit-btn" onclick="app.editTodo(${todo.id})">âœ</button>
                            <button class="delete-btn" onclick="app.deleteTodo(${todo.id})">ğŸ—‘</button>
                        </div>
                    </div>
                `;
            }

            updateStats() {
                const total = this.todos.length;
                const completed = this.todos.filter(todo => todo.completed).length;
                const pending = total - completed;
                
                document.getElementById('totalCount').textContent = `${total}/100`;
                document.getElementById('completedCount').textContent = completed;
                document.getElementById('pendingCount').textContent = pending;
                
                this.updateProgressBar(total, 100);
                this.updateTodoLimitInfo(total, 100);
            }

            updateProgressBar(current, max) {
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                
                if (progressFill && progressText) {
                    const percentage = Math.min((current / max) * 100, 100);
                    progressFill.style.width = `${percentage}%`;
                    progressText.textContent = `${Math.round(percentage)}% (${current}/${max})`;
                }
            }

            updateTodoLimitInfo(current, max) {
                const limitInfo = document.getElementById('todoLimitInfo');
                if (limitInfo) {
                    const remaining = max - current;
                    if (remaining <= 0) {
                        limitInfo.textContent = 'å·²é”åˆ°è¨˜äº‹ä¸Šé™ï¼';
                        limitInfo.style.color = '#ff4444';
                    } else if (remaining <= 10) {
                        limitInfo.textContent = `é‚„å¯æ–°å¢ ${remaining} å‰‡è¨˜äº‹`;
                        limitInfo.style.color = '#ff8800';
                    } else {
                        limitInfo.textContent = `é‚„å¯æ–°å¢ ${remaining} å‰‡è¨˜äº‹`;
                        limitInfo.style.color = '#4CAF50';
                    }
                }
            }

            saveTodos() {
                try {
                    const todosJson = JSON.stringify(this.todos);
                    localStorage.setItem('todos', todosJson);
                } catch (error) {
                    console.error('å„²å­˜åˆ°localStorageæ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                }
            }

            // PWA ç›¸é—œæ–¹æ³•
            showInstallPrompt() {
                // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰å®‰è£æç¤º
                if (document.getElementById('installPrompt')) {
                    return;
                }

                // å‰µå»ºå®‰è£æç¤º
                const installPrompt = document.createElement('div');
                installPrompt.id = 'installPrompt';
                installPrompt.className = 'install-prompt';
                installPrompt.innerHTML = `
                    <div class="install-content">
                        <p>ğŸ“± å°‡æ­¤APPå®‰è£åˆ°æ‰‹æ©Ÿä¸»ç•«é¢</p>
                        <button id="installBtn" class="install-btn">å®‰è£</button>
                        <button id="dismissInstall" class="dismiss-btn">ç¨å¾Œ</button>
                    </div>
                `;
                
                document.body.appendChild(installPrompt);
                
                // ç¶å®šæŒ‰éˆ•äº‹ä»¶
                document.getElementById('installBtn').addEventListener('click', () => this.installApp());
                document.getElementById('dismissInstall').addEventListener('click', () => this.hideInstallPrompt());
                
                // 3ç§’å¾Œè‡ªå‹•éš±è—
                setTimeout(() => {
                    this.hideInstallPrompt();
                }, 10000);
            }

            hideInstallPrompt() {
                const installPrompt = document.getElementById('installPrompt');
                if (installPrompt) {
                    installPrompt.remove();
                }
            }

            async installApp() {
                if (this.deferredPrompt) {
                    this.deferredPrompt.prompt();
                    const { outcome } = await this.deferredPrompt.userChoice;
                    if (outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        this.showNotification('APPå®‰è£æˆåŠŸï¼', 'success');
                    } else {
                        console.log('User dismissed the install prompt');
                        this.showNotification('å®‰è£å·²å–æ¶ˆ', 'info');
                    }
                    this.deferredPrompt = null;
                    this.hideInstallPrompt();
                } else {
                    // å¦‚æœæ²’æœ‰ deferredPromptï¼Œé¡¯ç¤ºæ‰‹å‹•å®‰è£èªªæ˜
                    this.showManualInstallInstructions();
                }
            }

            showManualInstallInstructions() {
                const instructions = `
                    <div class="manual-install-modal">
                        <div class="manual-install-content">
                            <h3>ğŸ“± æ‰‹å‹•å®‰è£èªªæ˜</h3>
                            <div class="install-steps">
                                <h4>Android (Chrome):</h4>
                                <p>1. é»æ“Šç€è¦½å™¨é¸å–® (â‹®)</p>
                                <p>2. é¸æ“‡ã€Œå®‰è£æ‡‰ç”¨ç¨‹å¼ã€</p>
                                <p>3. é»æ“Šã€Œå®‰è£ã€</p>
                                
                                <h4>iOS (Safari):</h4>
                                <p>1. é»æ“Šåˆ†äº«æŒ‰éˆ• (â–¡â†‘)</p>
                                <p>2. é¸æ“‡ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</p>
                                <p>3. é»æ“Šã€Œæ–°å¢ã€</p>
                            </div>
                            <button onclick="this.parentElement.parentElement.remove()" class="close-btn">é—œé–‰</button>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', instructions);
            }

            updateConnectionStatus() {
                // å¯ä»¥æ·»åŠ ç¶²è·¯ç‹€æ…‹æŒ‡ç¤ºå™¨
            }

            showOfflineNotice() {
                const offlineNotice = document.createElement('div');
                offlineNotice.id = 'offlineNotice';
                offlineNotice.className = 'offline-notice';
                offlineNotice.innerHTML = '<p>ğŸ“¶ æ‚¨ç›®å‰è™•æ–¼é›¢ç·šç‹€æ…‹ï¼Œä½†APPä»å¯æ­£å¸¸ä½¿ç”¨</p>';
                document.body.appendChild(offlineNotice);
            }

            hideOfflineNotice() {
                const offlineNotice = document.getElementById('offlineNotice');
                if (offlineNotice) {
                    offlineNotice.remove();
                }
            }

            showNotification(message, type = 'info') {
                // ç§»é™¤ç¾æœ‰çš„é€šçŸ¥
                const existingNotification = document.querySelector('.notification');
                if (existingNotification) {
                    existingNotification.remove();
                }

                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                // è‡ªå‹•ç§»é™¤é€šçŸ¥
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        notification.remove();
                    }
                }, 3000);
            }
        }

        // å…¨åŸŸè®Šæ•¸
        let app;

        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            app = new TodoApp();
        });

        // è§¸æ§æ‰‹å‹¢æ”¯æ´
        let startX = 0;
        let startY = 0;

        document.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        });

        document.addEventListener('touchend', (e) => {
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            
            const diffX = startX - endX;
            const diffY = startY - endY;
            
            // æ°´å¹³æ»‘å‹•åˆ‡æ›æ¨™ç±¤
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
                const tabs = ['today', 'week', 'all', 'overdue'];
                const currentIndex = tabs.indexOf(app.currentFilter);
                
                if (diffX > 0 && currentIndex < tabs.length - 1) {
                    // å‘å·¦æ»‘å‹•ï¼Œä¸‹ä¸€å€‹æ¨™ç±¤
                    app.switchTab(tabs[currentIndex + 1]);
                } else if (diffX < 0 && currentIndex > 0) {
                    // å‘å³æ»‘å‹•ï¼Œä¸Šä¸€å€‹æ¨™ç±¤
                    app.switchTab(tabs[currentIndex - 1]);
                }
            }
        });

        // éµç›¤å¿«æ·éµæ”¯æ´
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case '1':
                        e.preventDefault();
                        app.switchTab('today');
                        break;
                    case '2':
                        e.preventDefault();
                        app.switchTab('week');
                        break;
                    case '3':
                        e.preventDefault();
                        app.switchTab('all');
                        break;
                    case '4':
                        e.preventDefault();
                        app.switchTab('overdue');
                        break;
                }
            }
        });
    </script>
</body>
</html>
